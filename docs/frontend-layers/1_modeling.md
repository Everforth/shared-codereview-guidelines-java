## モデリング層（型定義, ストア定義 等）

### レビュー前の確認事項

**実装意図の理解**

レビュー時は以下を自問してください:

1. **この変更は PR の目的を達成しているか?**
   - PR Description の「なぜやるか」と照らし合わせる

2. **実装された仕様は妥当か?**
   - オプショナル (`?`) の使用は仕様に基づいているか
   - 配列/オブジェクトの構造は API/仕様と一致しているか

3. **既存パターンに従っているか?**
   - 類似の機能の実装と比較
   - プロジェクト固有の慣習に従っているか

### 必須チェック項目

- **型定義の一貫性**: 既存の型定義を再利用し、新規型は必要最小限に抑えているか
- **API仕様との整合性**: APIレスポンスの型定義が正確で、エンドポイントとの対応が明確か
- **ストア設計の適切性**: 既存パターンに従い、state/actions/gettersが適切に設計されているか
- **エラーハンドリング**: すべてのaxiosリクエストに適切な`catch`処理が実装されているか
- **メッセージ表示の責務**: 成功/失敗メッセージ（トースト等）はStore側で出しているか。処理結果を知っているのはStoreであり、View側で出す場合は処理の成功を確認してからでないと不整合が起きる
- **loading状態の所在**: Storeにloading状態を持たせていないか。loading中かどうかはUIの関心事であり、Storeのビジネスロジックではない
- **Storeの戻り値**: axios instanceを直接returnしていないか。Storeは「何のAPIを叩いているか」を外部に漏らさず、`return new Promise`でラップして抽象化する

### ストア実装パターン

#### stateの定義

- エンティティのコレクションとページネーション情報を分離して定義する
- 単一エンティティ用の状態は `current{Entity}` の命名規則に従う
- null許容型は適切に使用する（初期状態やデータ未取得時を表現）

#### actionsの実装

**Fire-and-forget パターン（最も一般的）**

- Store内でAPI呼び出し・state更新・メッセージ表示を完結させ、戻り値なし
- `then`でstateに格納、`catch`でエラーメッセージを表示
- コンポーネント側でtry-catchは使用しない

**Promise-returning パターン（結果が必要な場合のみ）**

- コンポーネント側で`.then()`チェーンが必要な場合（作成・削除・ログイン等）に限定して使用
- `new Promise()`でラップして返却し、axios instanceを直接returnしない
- `resolve`でレスポンスデータを返す
- `catch`でエラーログを出力し、`reject`で呼び出し元にエラーを伝播する

**エラーハンドリングの責務分離**

- エラーメッセージ表示はStore内（Quasar Notify等）で完結させる
- Vueコンポーネントではtry-catchを使用しない

### パフォーマンス考慮点：

- 不要なAPI呼び出しの削減
- stateの適切な初期化と管理

### 設計・命名規則

- 型定義ファイル名は `{entity}.type.ts` 形式
- ストア名は `use{Entity}Store` 形式
- メソッド名は `get{Entity}`, `create{Entity}`, `update{Entity}`, `delete{Entity}` 形式

### Vue.js 型定義の特有の注意点

#### Emit 定義

- `defineEmits`でTypeScript型定義を使用する
- イベント名と引数の型を明示的に定義する
- ランタイムのみの定義は避け、型安全性を確保する

#### Props 定義

- `defineProps`でTypeScript型定義を使用する
- ランタイムのみの型定義（`Array`, `Object`など）は避ける
- 具体的な型（`NextAction[]`など）を指定する

#### Computed/Reactive の型推論

- computedの返り値型は明示的に指定しない（型推論に任せる）
- ref/reactiveの型は初期値から推論できる場合は省略可能
- 空配列や空オブジェクトの場合は明示的な型指定が必要

### レビューコメントの判断基準

#### ❌ コメントすべきでない例

- 「〜の可能性がある」という仮説的な問題
- 既存コードでも同様に対応されていない一般論
- 明確な根拠のない「ベストプラクティス」
- 現在のPRの目的・スコープ外の改善提案

#### ✅ コメントすべき例

- 明確なバグや不具合
- API仕様との不一致が確認できる箇所
- 既存の実装パターンとの明確な不一致
- セキュリティリスクやパフォーマンス問題

**判断の原則**:
「このコードが原因で実際に問題が起きる具体的なシナリオを説明できるか?」
説明できない場合は指摘しない。

### レビュー対象外

以下はモデリング層ではなく、他の層でレビューすること：

- **ページコンポーネント**（\*.vue ファイル）→ プロトタイピング層で扱う
- **ルーティング定義**（router 設定）→ プロトタイピング層で扱う
- **メッセージの文言やタイミング** → 表示・スタイリング層で扱う
- **UIコンポーネント**（template 部分）→ 表示・スタイリング層で扱う
- **フォーム処理**（バリデーション、送信処理）→ データ処理層で扱う
- **loading状態の有無自体の判断**（View側の実装方針）→ データ処理層で扱う
